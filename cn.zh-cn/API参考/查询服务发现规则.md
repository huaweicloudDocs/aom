# 查询服务发现规则<a name="ZH-CN_TOPIC_0135040578"></a>

## 功能介绍<a name="section203286341334"></a>

该接口用于查询系统当前已存在的服务发现规则。

## URI<a name="section66851047034"></a>

GET /v1/\{project\_id\}/inv/servicediscoveryrules?id=\{id\}

## 请求消息<a name="section171231385411"></a>

**请求参数**

参数说明请参见[表1](#table193034241619)。

**表 1**  参数说明

<a name="table193034241619"></a>
<table><thead align="left"><tr id="row1230372413618"><th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.1"><p id="p39631945091"><a name="p39631945091"></a><a name="p39631945091"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.2"><p id="p59631452094"><a name="p59631452094"></a><a name="p59631452094"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.3"><p id="p194581024135412"><a name="p194581024135412"></a><a name="p194581024135412"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.4"><p id="p1234732810543"><a name="p1234732810543"></a><a name="p1234732810543"></a>取值范围</p>
</th>
<th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.5"><p id="p99638453919"><a name="p99638453919"></a><a name="p99638453919"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row163031424861"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.1 "><p id="p5964184514915"><a name="p5964184514915"></a><a name="p5964184514915"></a>project_id</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.2 "><p id="p09641456913"><a name="p09641456913"></a><a name="p09641456913"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.3 "><p id="p1314165411541"><a name="p1314165411541"></a><a name="p1314165411541"></a>string</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.4 "><p id="p1434720284547"><a name="p1434720284547"></a><a name="p1434720284547"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.5 "><p id="p29640451920"><a name="p29640451920"></a><a name="p29640451920"></a>租户从IAM申请到的projectid，一般为32位字符串。</p>
</td>
</tr>
<tr id="row1984410525197"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.1 "><p id="p567819732111"><a name="p567819732111"></a><a name="p567819732111"></a>id</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.2 "><p id="p0678779216"><a name="p0678779216"></a><a name="p0678779216"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.3 "><p id="p1790525413548"><a name="p1790525413548"></a><a name="p1790525413548"></a>string</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.4 "><p id="p93471928205415"><a name="p93471928205415"></a><a name="p93471928205415"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.5 "><p id="p267877112117"><a name="p267877112117"></a><a name="p267877112117"></a>具体的服务发现规则ID，可以精确匹配到一条服务发现规则。不传时返回project下所有服务发现规则的列表。</p>
</td>
</tr>
</tbody>
</table>

**Header说明**

请求消息头（Header）如[表2](#table360364820109)所示。

**表 2**  Header说明

<a name="table360364820109"></a>
<table><thead align="left"><tr id="row160414482102"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.1"><p id="p4167181520117"><a name="p4167181520117"></a><a name="p4167181520117"></a>名称</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.2"><p id="p161672015141113"><a name="p161672015141113"></a><a name="p161672015141113"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="p2167101551119"><a name="p2167101551119"></a><a name="p2167101551119"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row1660444861012"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p171671315151111"><a name="p171671315151111"></a><a name="p171671315151111"></a>X-Auth-Token</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p9167101511117"><a name="p9167101511117"></a><a name="p9167101511117"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p6167171512113"><a name="p6167171512113"></a><a name="p6167171512113"></a>从IAM服务获取的用户Token。</p>
</td>
</tr>
<tr id="row10604124811020"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p19167181581113"><a name="p19167181581113"></a><a name="p19167181581113"></a>Content-Type</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p1316751591117"><a name="p1316751591117"></a><a name="p1316751591117"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p21671515131116"><a name="p21671515131116"></a><a name="p21671515131116"></a>指定类型为application/json。</p>
</td>
</tr>
</tbody>
</table>

## 响应消息<a name="section583412267417"></a>

**响应参数**

响应参数如[表3](#table158217498143)所示。

**表 3**  响应参数

<a name="table158217498143"></a>
<table><thead align="left"><tr id="row6822134951411"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.1"><p id="p1485620131519"><a name="p1485620131519"></a><a name="p1485620131519"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.2"><p id="p78566081514"><a name="p78566081514"></a><a name="p78566081514"></a>类型</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="p885620131515"><a name="p885620131515"></a><a name="p885620131515"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row16822194941416"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p740481019151"><a name="p740481019151"></a><a name="p740481019151"></a>errorCode</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p12719132011516"><a name="p12719132011516"></a><a name="p12719132011516"></a>string</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p13719172011518"><a name="p13719172011518"></a><a name="p13719172011518"></a>响应码，AOM_INVENTORY_2000000代表正常返回。</p>
</td>
</tr>
<tr id="row582214497149"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p1840441016154"><a name="p1840441016154"></a><a name="p1840441016154"></a>errorMessage</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p6720720201519"><a name="p6720720201519"></a><a name="p6720720201519"></a>string</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p67201020131513"><a name="p67201020131513"></a><a name="p67201020131513"></a>响应信息描述。</p>
</td>
</tr>
<tr id="row1682211496147"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p3404610191511"><a name="p3404610191511"></a><a name="p3404610191511"></a>appRules</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p27207204154"><a name="p27207204154"></a><a name="p27207204154"></a>JSON array对象</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p1472032013159"><a name="p1472032013159"></a><a name="p1472032013159"></a>查询结果规则信息。详见<a href="添加或修改服务发现规则.md#table121871221724">表2</a>。</p>
</td>
</tr>
</tbody>
</table>

**响应示例**

```
{
    "errorCode": "SVCSTG.INV.2000000",
    "errorMessage": null,
    "appRules": [
        {
            "projectid": "5a6036f48e954fcd84d198cb28db311a",
            "id": "b788349e-62b2-3c7a-b597-02c611d59801",
            "name": "aaw",
            "enable": true,
            "hostid": [],
            "eventName": "aom_inventory_rules_event",
            "spec": {
                "appType": "",
                "attrList": [
                    "cmdLine"
                ],
                "discoveryRule": [
                    {
                        "checkType": "cmdLine",
                        "checkMode": "contain",
                        "checkContent": [
                            "/usr/local/bin/kube-proxy"
                        ]
                    },
                    {
                        "checkType": "scope",
                        "checkMode": "equals",
                        "checkContent": [
                            "80011a1d-1575-4546-9f9b-abc866862fd2"
                        ]
                    }
                ],
                "nameRule": {
                    "appNameRule": [
                        {
                            "nameType":"cmdLineHash",
                            "agrs":["00000000001"],
                            "value":["serviceName1"]
                        },
                        {
                            "nameType": "env",
                            "args": [
                                "APP_NAME"
                            ]
                        }
                    ],
                    "applicationNameRule": [
                        {
                            "nameType":"cmdLineHash",
                            "agrs":["00000000001"],
                            "value":["applicationName1"]
                        },

                        {
                            "nameType": "str",
                            "args": [
                                "/usr/local/bin/kube-proxy"
                            ]
                        }
                    ]
                },
                "detectLog": "true",
                "logFileFix": [
                    "log",
                    "trace"
                ],
                "priority": 12,
                "isDetect": "false",
                "isDefaultRule":"false",
                "logPathRule": [
                    {
                        "nameType":"cmdLineHash",
                        "agrs":["00000000001"],
                        "value":["/xx/xxx/xx.log","/xx/xxx/xx"]
                    }
                ]

            },
            "createTime": "1536050184834"
        }
    ]
}
```

## 状态码<a name="section208819506415"></a>

-   正常

    状态码如[表4](#table1581142134710)所示。


**表 4**  状态码

<a name="table1581142134710"></a>
<table><thead align="left"><tr id="row13810162111471"><th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.1"><p id="p681012124715"><a name="p681012124715"></a><a name="p681012124715"></a>状态码</p>
</th>
<th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.2"><p id="p7810122114479"><a name="p7810122114479"></a><a name="p7810122114479"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row48111121114712"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p38110218476"><a name="p38110218476"></a><a name="p38110218476"></a>200</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p10811102154710"><a name="p10811102154710"></a><a name="p10811102154710"></a>查询警报成功。</p>
</td>
</tr>
</tbody>
</table>

-   异常

    状态码如[表5](#table28131021134718)所示。更多状态码请见[状态码](状态码.md)


**表 5**  状态码

<a name="table28131021134718"></a>
<table><thead align="left"><tr id="row188127212470"><th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.1"><p id="p08121321174720"><a name="p08121321174720"></a><a name="p08121321174720"></a>状态码</p>
</th>
<th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.2"><p id="p19812521124715"><a name="p19812521124715"></a><a name="p19812521124715"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row2813421144712"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p17537181217491"><a name="p17537181217491"></a><a name="p17537181217491"></a>400 Bad Request</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p155376128493"><a name="p155376128493"></a><a name="p155376128493"></a>请求错误。</p>
</td>
</tr>
<tr id="row181372164717"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p6537101204915"><a name="p6537101204915"></a><a name="p6537101204915"></a>401 Unauthorized</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p10537012204913"><a name="p10537012204913"></a><a name="p10537012204913"></a>未提供认证信息，或认证信息错。</p>
</td>
</tr>
<tr id="row138131821114719"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p125381612184917"><a name="p125381612184917"></a><a name="p125381612184917"></a>403 Forbidden</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p3538201220492"><a name="p3538201220492"></a><a name="p3538201220492"></a>请求页面被禁止访问。</p>
</td>
</tr>
<tr id="row1581318210476"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p14538151220497"><a name="p14538151220497"></a><a name="p14538151220497"></a>500 Internal Server Error</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p85381712114915"><a name="p85381712114915"></a><a name="p85381712114915"></a>请求未完成，服务异常。</p>
</td>
</tr>
<tr id="row78131021184710"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p253811129494"><a name="p253811129494"></a><a name="p253811129494"></a>503 Service Unavailable</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p19538131217492"><a name="p19538131217492"></a><a name="p19538131217492"></a>系统暂时不可用，请求受限。</p>
</td>
</tr>
</tbody>
</table>

## 错误码<a name="section260818594420"></a>

**表 6**  错误码

<a name="table174391730152412"></a>
<table><thead align="left"><tr id="row1844063042419"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.1"><p id="p172074318246"><a name="p172074318246"></a><a name="p172074318246"></a>错误码</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.2"><p id="p122110432244"><a name="p122110432244"></a><a name="p122110432244"></a>错误信息</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="p1321104314247"><a name="p1321104314247"></a><a name="p1321104314247"></a>处理措施</p>
</th>
</tr>
</thead>
<tbody><tr id="row154411230132413"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p6216435244"><a name="p6216435244"></a><a name="p6216435244"></a>SVCSTG.INV.4030000</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p10216431240"><a name="p10216431240"></a><a name="p10216431240"></a>Forbidden</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p8211243142410"><a name="p8211243142410"></a><a name="p8211243142410"></a>使用有权限的账户。</p>
</td>
</tr>
<tr id="row24419307249"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p10226439243"><a name="p10226439243"></a><a name="p10226439243"></a>SVCSTG.INV.5000001</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p132254313247"><a name="p132254313247"></a><a name="p132254313247"></a>Elasticsearch session is null</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p11228434247"><a name="p11228434247"></a><a name="p11228434247"></a>请联系管理员解决。</p>
</td>
</tr>
<tr id="row34417307245"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p1822164315248"><a name="p1822164315248"></a><a name="p1822164315248"></a>SVCSTG.INV.5000002</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p1722174311243"><a name="p1722174311243"></a><a name="p1722174311243"></a>Elasticsearch execute exception</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p62314342414"><a name="p62314342414"></a><a name="p62314342414"></a>请联系管理员解决。</p>
</td>
</tr>
</tbody>
</table>

